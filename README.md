## Быстрый старт

1. Клонировать репозиторий и перейти в каталог проекта:
git clone https://github.com/sanisan1/Bank
cd Bank3

2. Собрать приложение (без запуска тестов):
mvn clean package -DskipTests


3. Запустить инфраструктуру и приложение через Docker Compose  
(поднимутся PostgreSQL, Kafka и само приложение):
docker-compose up -d


4. Приложение будет доступно по адресу:
- Backend: http://localhost:8080

### Быстрое тестирование через Postman

В репозитории есть готовая коллекция Postman (каталог `postman/`),  
которая покрывает основной функционал: аутентификацию, работу со счетами,  
финансовые операции и уведомления.  
Импортируйте коллекцию в Postman и выполните запросы по шагам, чтобы быстро проверить API.   ТАМ ЖЕ ЕСТЬ КРАТКАЯ ДОКУМЕНТАЦИЯ ПОСТМАНА У КОЛЛЕКЦИИ!!!!!!





# Банковская система Bank3

## Обзор проекта

Это полнофункциональное банковское приложение, разработанное с использованием Spring Boot. Приложение предоставляет возможности управления банковскими счетами, выполнения финансовых операций, аутентификации пользователей и обработки уведомлений через систему сообщений Kafka.

## Архитектура приложения

### Основные технологии:
- **Spring Boot 3.4.5** - основной фреймворк
- **Java 17** - язык программирования
- **PostgreSQL** - основная база данных
- **Apache Kafka** - система обмена сообщениями для уведомлений
- **Spring Security + JWT** - безопасность и аутентификация
- **Spring Data JPA** - работа с базой данных
- **Maven** - система сборки проекта

### Структура проекта:
```
src/
├── main/
│   ├── java/
│   │   └── com/example/bank/
│   │       ├── controller/     # REST контроллеры
│   │       ├── service/        # Бизнес-логика
│   │       ├── repository/     # Репозитории для работы с БД
│   │       ├── model/          # Модели данных
│   │       ├── security/       # Конфигурация безопасности
│   │       ├── kafka/          # Интеграция с Kafka
│   │       ├── mapper/         # Мапперы для преобразования моделей
│   │       ├── exception/      # Обработка исключений
│   │       ├── Enums/          # Перечисления
│   │       └── BankApplication.java # Точка входа
│   └── resources/
└── test/                       # Тесты (интеграционные и unit)
```

## Функциональность

### 1. Управление пользователями
- Регистрация новых пользователей
- Аутентификация с помощью JWT токенов
- Разграничение ролей (USER, ADMIN)
- Блокировка пользователей

### 2. Типы банковских счетов
#### Дебетовый счет (DebitCard)
- Хранит средства клиента
- Операции возможны только в пределах доступного баланса
- Нельзя уйти в минус

#### Кредитный счет (CreditCard)
- Расширенная функциональность по сравнению с дебетовым счетом
- Баланс показывает общую сумму которую можно потратить с карты (работает как кредитка в обычном банке)
- Поддержка процентных ставок и начисления процентов
- Проценты начисляются только на тело долга
### На доработке
- Управление задолженностями и минимальными платежами
- Грейс-период

### 3. Финансовые операции
- **Пополнение счета** - увеличение баланса
- **Снятие средств** - уменьшение баланса
- **Перевод между счетами** - перевод средств от одного счета к другому
- Все операции защищены системой безопасности (только владелец может выполнять операции)

### 4. Уведомления
- Интеграция с Apache Kafka для отправки уведомлений
- Отправка событий при каждой финансовой операции
- Обработка входящих сообщений

### 5. История транзакций
- Полная история всех операций по каждому счету
- Фильтрация транзакций по счетам и пользователям
- Просмотр деталей каждой транзакции

## Безопасность
- JWT-токены для аутентификации
- Spring Security для авторизации
- Защита от несанкционированного доступа к счетам
- Шифрование паролей
- Разграничение прав доступа (пользователь/администратор)

## API эндпоинты

### Аутентификация
- `POST /api/auth/register` - регистрация нового пользователя
- `POST /api/auth/login` - вход в систему

### Работа со счетами
- `POST /api/cards/create-debit` - создание дебетового счета
- `POST /api/cards/create-credit` - создание кредитного счета
- `GET /api/cards/{cardNumber}` - получение информации о счете
- `PUT /api/cards/block/{cardNumber}` - блокировка счета

### Финансовые операции
- `POST /api/transactions/deposit` - пополнение счета
- `POST /api/transactions/withdraw` - снятие средств
- `POST /api/transactions/transfer` - перевод между счетами

### Транзакции
- `GET /api/transactions/{id}` - получение конкретной транзакции
- `GET /api/transactions/by-card/{cardNumber}` - получение транзакций по счету
- `GET /api/transactions/getAllForUser` - получение всех транзакций текущего пользователя
- `GET /api/transactions/getAll` - (только для админов) получение всех транзакций системы

### Уведомления
- `GET /api/notifications` - получение уведомлений текущего пользователя
- `GET /api/notifications/user/{userId}` - получение уведомлений конкретного пользователя
- `DELETE /api/notifications/{id}` - удаление уведомления

## Запуск приложения

### Требования:
- Java 17+
- Docker и Docker Compose
- Maven 3.8+

### Запуск:
```bash
# Сборка проекта
mvn clean package

# Запуск с помощью Docker Compose (включает PostgreSQL и Kafka)
docker-compose up -d

# Приложение будет доступно по адресу: http://localhost:8080
```

## Тестирование
Проект включает в себя как unit-тесты, так и интеграционные тесты:
- Unit-тесты для сервисов (UserService, CardService, TransactionService и др.)
- Интеграционные тесты для контроллеров и всего приложения
- Используются H2 in-memory база данных для тестов

## Особенности реализации

1. **Наследование счетов**: Использована стратегия наследования JOINED в JPA для хранения разных типов счетов
2. **Безопасность**: Реализованы проверки прав доступа на уровне методов
3. **Событийная модель**: Использование Kafka для асинхронной обработки уведомлений
4. **Обработка ошибок**: Централизованная обработка исключений с возвратом понятных сообщений
5. **Логирование**: Подробное логирование операций для отладки и аудита

