## Быстрый старт

1. Клонировать репозиторий и перейти в каталог проекта:
   git clone https://github.com/sanisan1/Bank3
   cd Bank3

2. Собрать приложение (без запуска тестов):
   mvn clean package -DskipTests


3. Запустить инфраструктуру и приложение через Docker Compose  
   (поднимутся PostgreSQL, Kafka и само приложение):
   docker-compose up -d


4. Приложение будет доступно по адресу:
- Backend: http://localhost:8080

### Быстрое тестирование через Postman

В репозитории есть готовая коллекция Postman (каталог `postman/`),  
которая покрывает основной функционал: аутентификацию, работу со счетами,  
финансовые операции и уведомления.  
Импортируйте коллекцию в Postman и выполните запросы по шагам, чтобы быстро проверить API.   ТАМ ЖЕ ЕСТЬ КРАТКАЯ ДОКУМЕНТАЦИЯ ПОСТМАНА У КОЛЛЕКЦИИ!!!!!!





# Банковская система Bank3

## Обзор проекта

Это полнофункциональное банковское приложение, разработанное с использованием Spring Boot. Приложение предоставляет возможности управления банковскими счетами, выполнения финансовых операций, аутентификации пользователей и обработки уведомлений через систему сообщений Kafka.

## Архитектура приложения

### Основные технологии:
- **Spring Boot 3.4.5** - основной фреймворк
- **Java 17** - язык программирования
- **PostgreSQL** - основная база данных
- **Apache Kafka** - система обмена сообщениями для уведомлений
- **Spring Security + JWT** - безопасность и аутентификация
- **Spring Data JPA** - работа с базой данных
- **Maven** - система сборки проекта

### Структура проекта:
```
src/
├── main/
│   ├── java/
│   │   └── com/example/bank/
│   │       ├── controller/     # REST контроллеры
│   │       ├── service/        # Бизнес-логика
│   │       ├── repository/     # Репозитории для работы с БД
│   │       ├── model/          # Модели данных
│   │       ├── security/       # Конфигурация безопасности
│   │       ├── kafka/          # Интеграция с Kafka
│   │       ├── mapper/         # Мапперы для преобразования моделей
│   │       ├── exception/      # Обработка исключений
│   │       ├── Enums/          # Перечисления
│   │       └── BankApplication.java # Точка входа
│   └── resources/
└── test/                       # Тесты (интеграционные и unit)
```

## Функциональность

### 1. Управление пользователями
- Регистрация новых пользователей
- Аутентификация с помощью JWT токенов
- Разграничение ролей (USER, ADMIN)
- Блокировка пользователей

### 2. Типы банковских счетов
#### Дебетовый счет (DebitAccount)
- Хранит средства клиента
- Операции возможны только в пределах доступного баланса
- Нельзя уйти в минус

#### Кредитный счет (CreditAccount)
- Расширенная функциональность по сравнению с дебетовым счетом
- Баланс показывает общую сумму которую можно потратить с карты (работает как кредитка в обычном банке)
- Поддержка процентных ставок и начисления процентов
- Проценты начисляются только на тело долга
### На доработке
- Управление задолженностями и минимальными платежами
- Грейс-период

### 3. Финансовые операции
- **Пополнение счета** - увеличение баланса
- **Снятие средств** - уменьшение баланса
- **Перевод между счетами** - перевод средств от одного счета к другому
- Все операции защищены системой безопасности (только владелец может выполнять операции)

### 4. Уведомления
- Интеграция с Apache Kafka для отправки уведомлений
- Отправка событий при каждой финансовой операции
- Обработка входящих сообщений

### 5. История транзакций
- Полная история всех операций по каждому счету
- Фильтрация транзакций по счетам и пользователям
- Просмотр деталей каждой транзакции

## Безопасность
- JWT-токены для аутентификации
- Spring Security для авторизации
- Защита от несанкционированного доступа к счетам
- Шифрование паролей
- Разграничение прав доступа (пользователь/администратор)



### Запуск:
```bash
# Сборка проекта
mvn clean package

# Запуск с помощью Docker Compose (включает PostgreSQL и Kafka)
docker-compose up -d

# Приложение будет доступно по адресу: http://localhost:8080
```

## Тестирование
Проект включает в себя как unit-тесты, так и интеграционные тесты:
- Unit-тесты для сервисов (UserService, AccountService, TransactionService и др.)
- Интеграционные тесты для контроллеров и всего приложения
- Используются H2 in-memory база данных для тестов

## Особенности реализации

1. **Наследование счетов**: Использована стратегия наследования JOINED в JPA для хранения разных типов счетов
2. **Сервис транзакций** Сервис транзакций написан таким образом, что выбирает сервис пополнения или вычитания денежных средств со счетов через специфичные для каждого типа счёта сервисы, за счёт чего не нужно переписывать сервис при добавлении новых типов счетов.
2. **Безопасность**: Реализованы проверки прав доступа на уровне методов
3. **Событийная модель**: Использование Kafka для асинхронной обработки уведомлений
4. **Обработка ошибок**: Централизованная обработка исключений с возвратом понятных сообщений
5. **Логирование**: Подробное логирование операций для отладки и аудита

# API


### AuthController
- `POST /auth/login` - Вход пользователя (Аутентификация пользователя и генерация JWT токена)


### RegistrationController
- `POST /register` - Регистрация пользователя (Регистрация нового пользователя в системе)

### UserController
- `POST /api/users` - Создать пользователя (Создание нового пользователя в системе)
- `GET /api/users` - Получить всех пользователей (Получение списка всех пользователей системы)
- `GET /api/users/{id}` - Получить пользователя по ID (Получение пользователя по его ID)
- `PATCH /api/users/{id}` - Обновить пользователя (Частичное обновление данных пользователя)
- `DELETE /api/users/{id}` - Удалить пользователя (Удаление пользователя по ID)

## Эндпоинты управления картами

### CardController
- `POST /api/cards/{id}/block` - Блокировка карты (Блокировка карты по ID)
- `POST /api/cards/{id}/unblock` - Разблокировка карты (Разблокировка карты по ID)
- `GET /api/cards/getCards` - Получить все карты (Получение списка всех карт пользователя)
- `GET /api/cards/getByNumber/{cardNumber}` - Получить карту по номеру (Получение карты по её номеру)
- `GET /api/cards/getById/{id}` - Получить карту по ID (Получение карты по её ID)
- `GET /api/cards/all` - Получить все карты с пагинацией (Получение всех карт с пагинацией и сортировкой)
- `GET /api/cards/search/number` - Поиск карт по номеру (Поиск карт по номеру карты)
- `POST /api/cards/{id}/request-block` - Запрос на блокировку карты (Отправка запроса на блокировку карты)
- `GET /api/cards/block-requests` - Запросы на блокировку с пагинацией (Получение запросов на блокировку карт с пагинацией)

### CreditCardController
- `POST /api/credit-cards/createforadmin` - Создать кредитную карту администратором (Создание кредитной карты администратором для пользователя)
- `POST /api/credit-cards/create` - Создать кредитную карту для себя (Создание кредитной карты пользователем для себя)
- `DELETE /api/credit-cards/{id}` - Удалить кредитную карту (Удаление кредитной карты по ID)
- `PUT /api/credit-cards/{id}/increase-limit` - Увеличить кредитный лимит (Увеличение кредитного лимита карты)
- `PUT /api/credit-cards/{id}/decrease-limit` - Уменьшить кредитный лимит (Уменьшение кредитного лимита карты)
- `PUT /api/credit-cards/{id}/set-interest` - Установить процентную ставку (Установка процентной ставки для кредитной карты)
- `POST /api/credit-cards/accrue-interest` - Начислить проценты (Ручной запуск начисления процентов по кредитным картам)

### DebitCardController
- `POST /api/debit-cards/{id}` - Создать дебетовую карту (Создание дебетовой карты для пользователя по ID)
- `DELETE /api/debit-cards/{id}` - Удалить дебетовую карту (Удаление дебетовой карты по ID)

## Эндпоинты транзакций

### TransactionController
- `POST /api/transactions/deposit` - Пополнение карты (Пополнение баланса карты)
- `POST /api/transactions/withdraw` - Снятие со счёта (Снятие средств с карты)
- `POST /api/transactions/transfer` - Перевод между картами (Перевод средств между картами)
- `GET /api/transactions/by-card/{cardNumber}` - Получить транзакции по карте (Получение списка транзакций по номеру карты)
- `GET /api/transactions/{id}` - Получить транзакцию по ID (Получение транзакции по её ID)
- `GET /api/transactions/getAll` - Получить все транзакции (Получение списка всех транзакций)
- `GET /api/transactions/by-user/{userId}` - Получить транзакции по пользователю (Получение транзакций по ID пользователя)
- `GET /api/transactions/getAllForUser` - Получить транзакции для текущего пользователя (Получение транзакций для авторизованного пользователя)

## Эндпоинты уведомлений

### NotificationController
- `GET /api/notifications/unread` - Получить непрочитанные уведомления (Получение списка непрочитанных уведомлений пользователя)
- `GET /api/notifications/all` - Получить все уведомления (Получение списка всех уведомлений пользователя)

## Безопасность

Большинство эндпоинтов требуют аутентификации с использованием JWT токенов. Токен аутентификации должен быть включен в заголовок Authorization как Bearer токен.



